-- percentage of Medicaid reimbursement per state
SELECT 
    STATE,
    SUM(MEDICAIDAMOUNTREIMBURSED) AS MEDICAID_TOTAL,
    SUM(NONMEDICAIDAMOUNTREIMBURSED) AS NON_MEDICAID_TOTAL,
    SUM(MEDICAIDAMOUNTREIMBURSED) + SUM(NONMEDICAIDAMOUNTREIMBURSED) AS TOTAL_REIMBURSED,
    ROUND(
        SUM(MEDICAIDAMOUNTREIMBURSED) * 100.0 / 
        NULLIF(SUM(MEDICAIDAMOUNTREIMBURSED) + SUM(NONMEDICAIDAMOUNTREIMBURSED), 0),
        2
    ) AS MEDICAID_PERCENT
FROM 
    SUD
WHERE SUPPRESSION_USED=FALSE AND STATE NOT IN ('XX')
GROUP BY 
    STATE
ORDER BY 
    MEDICAID_PERCENT DESC



